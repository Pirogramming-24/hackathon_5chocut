{% extends 'piro_index/base.html' %} 
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/signup.css' %}">
    <style>
        /* ë§ˆì´í˜ì´ì§€ ì „ìš© ëŒ“ê¸€ ìŠ¤íƒ€ì¼ (ìœ ì§€) */
        .comment-history { width: 460px; margin-top: 40px; }
        .comment-history h3 { color: #333; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #4A86E8; padding-bottom: 10px; }
        .comment-item { background: #fff; border: 1px solid #dadada; border-radius: 6px; padding: 15px; margin-bottom: 10px; }
        .comment-video-title { font-size: 12px; color: #4A86E8; font-weight: bold; margin-bottom: 5px; }
        .comment-content { font-size: 14px; color: #333; }
        .comment-date { font-size: 11px; color: #999; text-align: right; margin-top: 5px; }
        .empty-msg { text-align: center; color: #999; padding: 20px; }
    </style>
{% endblock extra_head %}

{% block content %}
<div class="account">
    <img src="{% static 'images/logo.png' %}" alt="ë¡œê³ " class="logo">
    
    <div class="signup-box">
        <h2 style="text-align: center; margin-bottom: 20px; color:#4A86E8;">ë‚´ ì •ë³´ ìˆ˜ì •</h2>
        <form method="POST">
            {% csrf_token %}
            
            <div class="input-group">
                <div class="input-row top">
                    <input class="input-field id" type="text" name="login_id" 
                           value="{{ user.login_id }}" 
                           data-initial="{{ user.login_id }}" 
                           placeholder="ì•„ì´ë””">
                </div>
                <div class="input-row mid">
                    <input class="input-field pw" type="password" name="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥)">
                </div>
            </div>

            <div class="input-group single" style="margin-top: 10px;">
                <div class="input-row">
                    <input class="input-field name" type="text" name="name" 
                           value="{{ user.name }}" 
                           data-initial="{{ user.name }}" 
                           placeholder="ì´ë¦„">
                </div>
            </div>

            <button type="submit" class="submit" disabled>ìˆ˜ì •í•˜ê¸°</button>
        </form>
    </div>

    <div class="comment-history">
        <h3>ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª¨ìŒ</h3>
        {% if comments %}
            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-video-title">ğŸ¬ {{ comment.video.title }}</div>
                <div class="comment-content">{{ comment.content }}</div>
                <div class="comment-date">{{ comment.created_at|date:"Y-m-d H:i" }}</div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-msg">ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const idInput = document.querySelector('.id');
        const pwInput = document.querySelector('.pw');
        const nameInput = document.querySelector('.name');
        const submitBtn = document.querySelector('.submit');

        // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ 'ì²˜ìŒ ê°’'ì„ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
        const initialId = idInput.getAttribute('data-initial');
        const initialName = nameInput.getAttribute('data-initial');

        function checkChanges() {
            // í˜„ì¬ ì…ë ¥ëœ ê°’ë“¤
            const currentId = idInput.value.trim();
            const currentName = nameInput.value.trim();
            const currentPw = pwInput.value.trim();

            // 1. ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸ (í•˜ë‚˜ë¼ë„ ë‹¤ë¥´ë©´ true)
            // - ì•„ì´ë””ê°€ ì²˜ìŒê³¼ ë‹¤ë¥¸ê°€?
            // - ì´ë¦„ì´ ì²˜ìŒê³¼ ë‹¤ë¥¸ê°€?
            // - ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒˆë¡œ ì…ë ¥í–ˆëŠ”ê°€?
            const isIdChanged = currentId !== initialId;
            const isNameChanged = currentName !== initialName;
            const isPwEntered = currentPw.length > 0;

            // 2. í•„ìˆ˜ ì…ë ¥ê°’(ê³µë°±) ì²´í¬
            const hasEmptyFields = currentId.length === 0 || currentName.length === 0;

            // ë¡œì§: ë­”ê°€ ë°”ë€Œì—ˆê³ (OR), í•„ìˆ˜ê°’ì´ ë¹„ì–´ìˆì§€ ì•Šì•„ì•¼ ë²„íŠ¼ í™œì„±í™”
            if ((isIdChanged || isNameChanged || isPwEntered) && !hasEmptyFields) {
                submitBtn.disabled = false; // íŒŒë€ìƒ‰ í™œì„±í™”
            } else {
                submitBtn.disabled = true;  // íšŒìƒ‰ ë¹„í™œì„±í™”
            }
        }
        
        // 3. (ìš”ì²­ì‚¬í•­ 1ë²ˆ) ë²„íŠ¼ í´ë¦­ ì‹œ ì•„ì´ë””ê°€ ë™ì¼í•˜ë©´ alert ë„ìš°ê¸°
        // ì‚¬ì‹¤ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ë©´ í´ë¦­ ìì²´ê°€ ì•ˆ ë˜ì§€ë§Œ, 
        // í˜¹ì‹œë‚˜ 'ì´ë¦„'ë§Œ ë°”ê¾¸ê³  'ì•„ì´ë””'ëŠ” ê·¸ëŒ€ë¡œ ë‘” ì±„ ì €ì¥í•  ë•Œë¥¼ ëŒ€ë¹„í•œ ì•ˆë‚´ ë¡œì§ì¼ ìˆ˜ ìˆì–´ ì¶”ê°€í•©ë‹ˆë‹¤.
        submitBtn.addEventListener('click', function(e) {
            const currentId = idInput.value.trim();
            
            // ì´ë¦„ì´ë‚˜ ë¹„ë²ˆì„ ë°”ê¿”ì„œ ë²„íŠ¼ì´ í™œì„±í™”ëëŠ”ë°, ì•„ì´ë””ëŠ” ê·¸ëŒ€ë¡œì¸ ê²½ìš°
            // "ì•„ì´ë””ê°€ ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤"ë¼ê³  ë„ìš°ëŠ” ê±´ ì¡°ê¸ˆ ì–´ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë³´í†µ ë³€ê²½ëœ ê²ƒë§Œ ì €ì¥í•˜ë‹ˆê¹Œìš”)
            // í˜•ë‹˜ì˜ ì˜ë„ê°€ "ì•„ì´ë””ë¥¼ ë°”ê¾¼ ì²™ í–ˆë‹¤ê°€ ë‹¤ì‹œ ì›ë³µí•˜ê³  ì €ì¥ ëˆ„ë¥´ë©´ ì•Œë ¤ì¤˜ë¼"ë¼ë©´ ìœ„ì˜ checkChangesì—ì„œ ì´ë¯¸ ë²„íŠ¼ì´ êº¼ì§€ë¯€ë¡œ ë§‰í™ë‹ˆë‹¤.
            
            // ë§Œì•½ "ë³€ê²½ëœ ì•„ì´ë””ê°€ DBì— ìˆëŠ” ë‹¤ë¥¸ ì‚¬ëŒ ì•„ì´ë””ë‘ ë˜‘ê°™ìœ¼ë©´" ê²½ê³ ë¥¼ ë„ìš°ëŠ” ê±°ë¼ë©´ views.pyì—ì„œ ì²˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.
            // ì¼ë‹¨ JSì—ì„œëŠ” "ë²„íŠ¼ì´ ì¼œì¡Œë‹¤ëŠ” ê±´ ë­”ê°€ ë°”ë€ ê²Œ ìˆë‹¤ëŠ” ëœ»"ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì œì¶œí•©ë‹ˆë‹¤.
        });

        // ê°ì‹œì ë¶™ì´ê¸°
        [idInput, pwInput, nameInput].forEach(input => {
            input.addEventListener('input', checkChanges);
        });
    });
</script>
{% endblock %}