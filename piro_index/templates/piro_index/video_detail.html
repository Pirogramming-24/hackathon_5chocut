    {% extends 'piro_index/base.html' %}
    {% load static %}

    {% block extra_head %}
        <link rel="stylesheet" href="{% static 'css/video_detail.css' %}">
        <script src="{% static 'js/video_detail.js' %}"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% endblock %}

    {% block content %}
    {% if is_staff %}
    <div class="admin-controls">
        <a href="{% url 'piro_index:video_update' video.pk %}" class="btn-edit-link">
            <button type="button" class="btn-edit-link-">ì˜ìƒ ìˆ˜ì •</button>
        </a>
        <form action="{% url 'piro_index:video_delete' video.pk %}" method="POST" 
            onsubmit="return confirm('ì •ë§ë¡œ ì´ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" style="display:inline;">
            {% csrf_token %}
        <button type="submit" class="btn-delete-link">ì˜ìƒ ì‚­ì œ</button>
        </form>
    </div>
    {% endif %}
    <div class="top">
        <div class="video_play">
            <video id="lecture" controls poster="{% static 'images/video_error.png' %}">
                <source src="{{ video.video_path.url }}" type="video/mp4">
            </video>
            <h3>{{ video.title }}</h3>
        </div>

        <div class="timeline_table">
            <h6>ğŸ“Œ ì£¼ìš” ê°œë… ë‹¤ì‹œë³´ê¸° ğŸ“Œ</h6>
            {% for timeline in timelines %}
                <div class="index_content" onclick="seekTo({{ timeline.timetag }}, this)">
                    <p class="main_concept">{{ timeline.content }}</p>
                    <p class="time format-time">{{ timeline.timetag }}</p>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="bottom" data-video-id="{{ video.pk }}">
        <div class="left">
            <div class="comment-container">
                <div class="input-area">
                    <input type="number" id="comment-timetag" placeholder="ì‹œê°„(ì´ˆ)" value="0">
                    <textarea id="comment-content" placeholder="ì´í•´ê°€ ê°€ì§€ ì•ŠëŠ” ì§ˆë¬¸ì„ ë“±ë¡í•´ì£¼ì„¸ìš”!"></textarea>
                    <input type="file" id="comment-image" accept="image/*">
                    <button type="button" id="comment-submit-btn">ë“±ë¡</button>
                </div>
            </div>

            <div id="comment-list-container">
                {% for comment in comments %}
                <div class="comment-item-card {% if comment.user.role == 'ìš´ì˜ì§„' %}staff-style{% endif %}" id="comment-{{ comment.pk }}">
                    
                    <div class="comment-header">
                        <span class="timetag format-time">{{ comment.timetag }}</span>
                        <strong>{{ comment.user.name }}</strong>
                    </div>

                    <div class="comment-body">
                        <p>{{ comment.content }}</p>
                        {% if comment.image %}
                        <div class="comment-image-container">
                            <img src="{{ comment.image.url }}" alt="ëŒ“ê¸€ ì´ë¯¸ì§€" class="comment-image">
                        </div>
                        {% endif %}
                    </div>

                    <div class="btn-group">
                        
                        <button class="reply-write-btn" data-comment-id="{{ comment.pk }}">ë‹µê¸€ ë‹¬ê¸°</button>
                        
                        {% if is_staff %}
                        <button class="btn-delete" data-comment-id="{{ comment.pk }}">ì‚­ì œ</button>
                        {% endif %}

                        <button class="like-btn" data-comment-id="{{ comment.pk }}">
                            ğŸ‘ (<span class="like-count">{{ comment.like_count }}</span>)
                        </button>

                        <button class="reply-toggle-btn" data-comment-id="{{ comment.pk }}">
                            ë‹µê¸€ {{ comment.replies_list|length }}ê°œ
                        </button>
                    </div>

                    <div class="toggle-wrapper">
                    <div class="reply-input-container" data-reply-input-id="{{ comment.pk }}">
                        <textarea class="reply-content" placeholder="ë‹µê¸€ ì‘ì„±..."></textarea>
                        <button class="reply-submit-btn" data-comment-id="{{ comment.pk }}">ë“±ë¡</button>
                    </div>
                    <div class="reply-container" data-reply-id="{{ comment.pk }}">
                        {% for reply in comment.replies_list %}
                        <div class="reply-item {% if reply.user.role == 'ìš´ì˜ì§„' %}staff-style{% endif %}">
                            <strong>{{ reply.user.name }}</strong>
                            <p>{{ reply.content }}</p>
                            <span class="reply-date">{{ reply.created_at }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    </div>

                </div> {% endfor %}
                
            </div> </div> <div class="graph_section">
            <canvas id="questionChart"></canvas> 
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // views.pyì—ì„œ ë³´ë‚¸ JSON ë°ì´í„°ë¥¼ JS ë³€ìˆ˜ë¡œ ë°›ìŒ
            const graphData = {{ graph_data_json|safe }};
            
            // video_detail.jsì— ìˆëŠ” í•¨ìˆ˜ í˜¸ì¶œ
            if (typeof drawEmpathyGraph === 'function') {
                drawEmpathyGraph(graphData);
            }
        });
    </script>
    {% endblock %}